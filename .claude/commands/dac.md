---
description: Draft a commit message
allowed-tools: Bash(git status:*), Bash(git diff:*), Bash(git log:*), Bash(git add:*), Bash(git commit:*), Bash(git push:*)
---

# Draft a Commit

Look at the changes that are ready to save and write a commit message that's inviting, focused, considerate, supportive, and influential.

## Autonomous Mode Improvements

### 1. Auto-Stage Changes
If nothing is staged but there are unstaged changes, automatically stage everything:
```bash
git add -A
```
This removes friction from the commit flow.

### 2. Auto-Commit for Small Changes
For autonomous work, auto-commit when ALL these conditions are met:
- Total diff is under 100 lines
- Changes are single-purpose (one logical unit)
- No sensitive files (.env, secrets, credentials)
- Changes pass basic validation (no syntax errors visible in diff)

When auto-committing, skip the "Would you like adjustments?" step and proceed directly to commit + push.

### 3. Smart Change Categorization
Detect change type from file patterns to choose the right prefix:

| Pattern | Prefix | Example |
|---------|--------|---------|
| `*.test.*`, `*.spec.*`, `e2e/*` | `Test:` | Test: Add checkout flow tests |
| `*.md`, `docs/*` | `Docs:` | Docs: Update API documentation |
| `.claude/*`, `*.config.*` | `Config:` | Config: Add commit-often rule |
| Bug keywords in diff (fix, resolve, patch) | `Fix:` | Fix: Resolve cart total calculation |
| New files with feature code | `Add:` | Add: User profile settings page |
| Deletions > additions | `Remove:` | Remove: Deprecated analytics code |
| Refactoring (same logic, different structure) | `Refactor:` | Refactor: Extract color utilities |

## Your Task

1. **Check what changed**
   ```bash
   git status
   git diff --staged  # or git diff if nothing staged
   git log --oneline -5
   ```

2. **Auto-stage if needed**
   If unstaged changes exist but nothing is staged:
   ```bash
   git add -A
   ```

3. **Analyze the diff**
   - Count total lines changed
   - Identify change category from file patterns
   - Check for sensitive files
   - Determine if single-purpose

4. **Draft the message following this structure:**

### Summary Line (under 50 characters)
- Use detected prefix (Add, Fix, Docs, Test, Config, Refactor, Remove)
- Be specific about what changed
- Capitalize first word, no period at end

### Body (explain what and why)
- Write a brief paragraph explaining WHAT changed and WHY it matters
- Include 2-4 bullet points highlighting key changes or benefits
- End with a sentence about how this helps people

5. **Decide: Auto-commit or Ask?**

   **Auto-commit** if:
   - Diff under 100 lines
   - Single-purpose change
   - No sensitive files
   - Clear category detected

   **Ask for approval** if:
   - Large diff (100+ lines)
   - Multiple unrelated changes
   - Ambiguous purpose
   - Contains potential sensitive data

## CRITICAL: NO Claude Code signature - EVER
- NEVER add `ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)`
- NEVER add `Co-Authored-By: Claude <noreply@anthropic.com>`
- NEVER add any AI attribution, robot emoji, or "generated by" text
- The commit message ends with the closing sentence about how it helps people - nothing after that

## Tone Guidelines

Make the message:
- **Inviting**: Use "This lets us...", "Now we can..."
- **Focused**: Be specific, avoid vague terms
- **Considerate**: Think about who this helps
- **Supportive**: Explain the reasoning and value
- **Influential**: Connect to bigger goals when relevant

## Example Format

```
Add search box to find books faster

This adds a search feature at the top of every page so visitors can
quickly find books by title, author, or topic without scrolling through
all the categories.

- Search box appears on every page for easy access
- Results appear instantly as you type
- Shows book covers and prices in search results

This makes it easier for customers to find exactly what they want and
helps them discover books they might have missed while browsing.
```

## Execution Flow

### For Small, Clear Changes (Auto-commit)
```
Detected: Config change, 45 lines, single-purpose
Auto-staging and committing...

git add -A && git commit -m "Config: Add commit-often rule..." && git push
```

### For Larger/Complex Changes (Ask)
```
Draft commit message:
[message here]

This is a larger change (150 lines across 8 files).
Would you like any adjustments before committing?
```

## After Approval

Once the user approves (says "no" to adjustments, "looks good", "ship it", etc.), execute:

```bash
git add -A && git commit -m "Your commit message here" && git push
```

Chain commands with `&&` to stop if any step fails.
